import os
import sys
from multiprocessing import Process

from PyQt5 import QtCore, QtGui, QtWidgets

import asyncio
from syncrypt import Vault
from syncrypt.app import SyncryptApp
from syncrypt.config import VaultConfig
from syncrypt.gui import SyncryptDesktop
from syncrypt.utils.logging import setup_logging
from syncrypt.app.auth import DummyAuthenticationProvider

setup_logging('DEBUG')

def run_gui():
    app = QtWidgets.QApplication(sys.argv)
    SyncryptWindow = SyncryptDesktop()
    SyncryptWindow.show()
    return app.exec_()

def run_daemon():
    app = SyncryptApp(VaultConfig(),
            auth_provider=DummyAuthenticationProvider(
                'test@syncrypt.space', 'test!password'))
    loop = asyncio.get_event_loop()
    loop.run_until_complete(app.start())
    loop.run_forever()

if __name__ == '__main__':
    p = Process(target=run_daemon)
    p.start()
    try:
        run_gui()
    finally:
        p.terminate()
