import sys

from concurrent.futures import ThreadPoolExecutor
from PyQt5 import QtCore, QtGui, QtWidgets

import asyncio
from syncrypt import Vault
from syncrypt.app import SyncryptApp
from syncrypt.config import VaultConfig
from syncrypt.gui import SyncryptDesktop
from syncrypt.utils.logging import setup_logging

setup_logging('DEBUG')

app = SyncryptApp(VaultConfig())

def run_syncrypt_gui():
    app = QtWidgets.QApplication(sys.argv)
    SyncryptWindow = SyncryptDesktop()
    SyncryptWindow.show()
    sys.exit(app.exec_())

@asyncio.coroutine
def main():
    loop = asyncio.get_event_loop()
    loop.set_default_executor(ThreadPoolExecutor())
    asyncio.async(app.start())
    out = yield from loop.run_in_executor(None, run_syncrypt_gui)

loop = asyncio.get_event_loop()
loop.run_until_complete(main())
